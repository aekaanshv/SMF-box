#!/bin/bash
# Below is an example script to run an automated SMF optimization procedure
# 
# It assumes the blackbox function takes a file containing a vector of design points to be tested
# and outputs a scalar into another file, which will be read by the optimizer
# Modify the script as according to your blackbox 


# Temporary file used as a queue for running multiple sequential candidates 
temppts="temp.dat"

# Name of the input file for test function
inpfile="c.txt"
# Nam eof output file for test function
outfile="sse.txt"

###############################################################

# Don't change these file names -- these are read by the optimizer
# Candidate points generated by optimizer 

ptsfile="xnew.dat"
Jfile="Jnew.dat"
endfile="stopfile"


##############################################################


# SMF Master loop ---------------------------------------------------

# To instead run a fixed number of optimization stages, comment the until statement 
# and uncomment the for statement with the desired number of stages
until [ -e $endfile ]
#for i in 1 2 3 .. 20
do

# Run optimization executable here
./krig

# Prepare files to run blackbox 
if [ -e $Jfile ]
then
  rm $Jfile
fi

cp $ptsfile $temppts

# Inner loop to run candidate points ----------------
while [ -s $temppts ]
do

head -n 1 $temppts > $inpfile

# Enter run command for blackbox executable here
./sphere


# Store evaluation into Jfile, to be read by optimizer
tail -n +2 $temppts > 1_$temppts

mv 1_$temppts $temppts

if [ -e $Jfile ] 
then
  cat $Jfile $outfile > 1_$Jfile
  mv 1_$Jfile $Jfile
else
  cp $outfile $Jfile
fi

done
# Inner loop end ----------------------------------

rm $temppts
done

# Loop end --------------------------------------------------------

# Run any desired post-processing commands here
